<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content List</title>
    <link rel="stylesheet" href="../css/content-list.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>
    <div class id="header"></div>
    <div class="container-list" style="margin-top: 100px;">
        <div class="container mt-4">
            <h1 class="text-center" style="font-size: 32px;">รายการเนื้อหา</h1>
            <button class="btn btn-primary mb-3" onclick="location.href='./add_data.html'">+ เพิ่มเนื้อหา</button>
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead class="table">
                        <tr>
                            <th>ลำดับ</th>
                            <th>ชื่อเนื้อหา</th>
                            <th>วันที่สร้าง</th>
                            <th>การจัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="content-list">
                        <tr>
                            <td colspan="4" class="text-center">กำลังโหลดข้อมูล...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        fetch("./header.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("header").innerHTML = data;
            })
            .catch(error => console.error("Error loading header:", error));

        function loadContentList() {
            fetch('../php/get-content-list.php')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const tbody = document.getElementById('content-list');
                    tbody.innerHTML = '';

                    if (data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="4">ไม่มีข้อมูล</td></tr>';
                        return;
                    }

                    data.forEach((item, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${item.name}</td>
                            <td>${item.created_at}</td>
                            <td>
                                <button onclick="viewContent(${item.id})">ดูรายละเอียด</button>
                                <button onclick="editContent(${item.id})">แก้ไข</button>
                                <button onclick="deleteContent(${item.id})" style="color: white;">ลบ</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    const tbody = document.getElementById('content-list');
                    tbody.innerHTML = '<tr><td colspan="4" style="color: red;">ไม่สามารถโหลดข้อมูลได้</td></tr>';
                });
        }

        function viewContent(id) {
            window.location.href = `./view-content.html?id=${id}`;
        }


        function editContent(id) {
            window.location.href = `./editor.html?id=${id}`;
        }

        function deleteContent(id) {
            if (confirm('คุณแน่ใจหรือไม่ว่าต้องการลบเนื้อหานี้?')) {
                fetch(`../php/delete-content.php?id=${id}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            alert('ลบเนื้อหาสำเร็จ');
                            loadContentList(); 
                        } else {
                            alert(`เกิดข้อผิดพลาด: ${result.message}`);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('เกิดข้อผิดพลาดในการลบเนื้อหา');
                    });
            }
        }

        loadContentList();
    </script>
</body>
</html>
